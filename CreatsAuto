function CreatAuto() {
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  var ТаблицаЛист_2 = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var ПоследняяСтрока = ТаблицаЛист_2.getLastRow();

  // закрашиваем область в серый цвет:

  var Серый = '#e9e9e9'; // Код цвета для серого
  var ВесьДиапазон = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 1, 10, 11);
  ВесьДиапазон.setBackground(Серый);

  // делаем ячейку для счета доходов и расходов в столбце N:

  var ДляСуммыДохода = ТаблицаЛист_2.getRange(ПоследняяСтрока, 14);
  var Белый = '#ffffff'; // Код цвета для белый
  ДляСуммыДохода.setFontColor(Белый);
  var ДляСуммыДоходаФормула = '=IF($A$' + (ПоследняяСтрока + 1) + '=0;" ";$A$' + (ПоследняяСтрока + 1) + ')';
  ДляСуммыДохода.setFormula(ДляСуммыДоходаФормула);

  // делаем выпадающий список авто и красим его в бежевый цвет:

  var ПоследняяСтрока = ТаблицаЛист_2.getLastRow();
  var АвтоЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 1);
  var Inputs = spreadsheet.getSheetByName("Inputs");
  var АвтоНазвания = Inputs.getRange("A2:A301");
  var АвтоПравило = SpreadsheetApp.newDataValidation().requireValueInRange(АвтоНазвания, true).build();
  АвтоЯчейка.setDataValidation(АвтоПравило);

  var Бежевый = '#fff2cc'; // Код цвета для бежевого
  АвтоЯчейка.setBackground(Бежевый);

  // делаем выпадающий список водителей и красим его в бежевый:

  var ВодительЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 3);
  var Inputs = spreadsheet.getSheetByName("Inputs");
  var ФИО_Водителей = Inputs.getRange("B2:B301");
  var ВодительПравило = SpreadsheetApp.newDataValidation().requireValueInRange(ФИО_Водителей, true).build();
  ВодительЯчейка.setDataValidation(ВодительПравило);
  ВодительЯчейка.setBackground(Бежевый);

  // находим строку по которой нужно найти дату справа:

  var столбец = 13; // по столбцу M
  var последняяСтрока = ТаблицаЛист_2.getLastRow();
  var диапазон = ТаблицаЛист_2.getRange(1, столбец, последняяСтрока, 1);
  var значения = диапазон.getValues();
  for (var i = последняяСтрока - 1; i >= 0; i--) 
  {
    if (значения[i][0] != "") {
      var последняяЯчейка = диапазон.getCell(i + 1, 1);
      var ПоследняяСтрокаM = i + 1;
      break;
    }
  }

  // делаем дату в ячейках 10 штук до ФИО водителей и 9 из них красим в серый:

  var ДатаЯчейки = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 2, 10, 1);
  var ДатаФормулы = "=($M$" + ПоследняяСтрокаM + ")";
  ДатаЯчейки.setFormula(ДатаФормулы);
  var СерыйДиапазонДата = ТаблицаЛист_2.getRange((ПоследняяСтрока + 2), 2, 9, 1)
  СерыйДиапазонДата.setFontColor(Серый)
  
  // делаем выпадающий список на плечи и закрашиваем его в бежевый:

  var ПлечоЯчейка = ТаблицаЛист_2.getRange(ПоследняяСтрока + 1, 4);
  var ПлечиЛист = spreadsheet.getSheetByName("Плечи(Лист1)");
  var ПлечиСписок = ПлечиЛист.getRange("A2:A301");
  var ПлечоПравило = SpreadsheetApp.newDataValidation().requireValueInRange(ПлечиСписок, true).build();
  ПлечоЯчейка.setDataValidation(ПлечоПравило);  
  ПлечоЯчейка.setBackground(Бежевый);
    
  // закрашиваем ячейку в бежевый для ввода кол-ва рейсов:

  var РейсЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 5);
  РейсЯчейка.setBackground(Бежевый);

  // добавляем формулы ВПР в Доход и Расход:

  var ДоходЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 6);
  var ДоходФормула = "=IFERROR(VLOOKUP(D" + (ПоследняяСтрока + 1) + ";'Плечи(Лист1)'!A:H;7;FALSE)*E" + (ПоследняяСтрока + 1) + ";0)";
  ДоходЯчейка.setFormula(ДоходФормула);
  var РасходЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 7);
  var РасходФормула = "=IFERROR(VLOOKUP(D" + (ПоследняяСтрока + 1) + ";'Плечи(Лист1)'!A:H;8;FALSE)*E" + (ПоследняяСтрока + 1) + ";0)+J" + (ПоследняяСтрока + 1);
  РасходЯчейка.setFormula(РасходФормула);

  // добавляем формулу ВПР в З/П водителя:

  var ЗПЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 9);
  var ЗПФормула = '=IFERROR(IF($H$' + (ПоследняяСтрока + 1) + '="да";VLOOKUP(D' + (ПоследняяСтрока + 1) + ";'Плечи(Лист1)'!A:I;6;FALSE)*E" + (ПоследняяСтрока + 1) + ';VLOOKUP(D' + (ПоследняяСтрока + 1) + ";'Плечи(Лист1)'!A:I;9;FALSE)*E" + (ПоследняяСтрока + 1) +');0)';
  ЗПЯчейка.setFormula(ЗПФормула);

  // добавляем формулу в З/П водителя + процент:

  var ЗП_ПроцентЯчейка = ТаблицаЛист_2.getRange(ПоследняяСтрока + 1, 10);
  var ЗП_ПроцентФормула = '=$I' + (ПоследняяСтрока + 1) + '+ $I' + (ПоследняяСтрока + 1) + "* 'Inputs'!$J$2";
  ЗП_ПроцентЯчейка.setFormula(ЗП_ПроцентФормула);

  // добавляем формулу ВПР в Суточные:

  var Суточные = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 11);
  var СуточныеФормула = '=IFERROR(VLOOKUP(D' + (ПоследняяСтрока + 1) + ";'Плечи(Лист1)'!A:K;11;FALSE);0)";
  Суточные.setFormula(СуточныеФормула);

  // добавляем 10 строк с Моделью Авто для Сводной таблицы в столбец O и сразу красим в белый:

  var МодельАвтоДляСводной = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 15, 10, 1);
  var МодельАвтоДляСводнойФормула = "=($A$" + (ПоследняяСтрока + 1) + ")";
  МодельАвтоДляСводной.setFormula(МодельАвтоДляСводнойФормула);
  var МодельАвтоДляСводнойБелый = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 15,10, 1)
  МодельАвтоДляСводнойБелый.setFontColor(Белый)

  // добавляем еще 9 строк с водителем и сразу красим их в серый:

  var ВодительЯчейки = ТаблицаЛист_2.getRange((ПоследняяСтрока + 2), 3, 9, 1);
  var ВодительФормулы = "=($C$" + (ПоследняяСтрока + 1) + ")";
  ВодительЯчейки.setFormula(ВодительФормулы);
  var СерыйДиапазонВодитель = ТаблицаЛист_2.getRange((ПоследняяСтрока + 2), 3, 9, 1)
  СерыйДиапазонВодитель.setFontColor(Серый)

  // добавляем еще 9 строк с плечом:

  var НачальныеКоординаты = ТаблицаЛист_2.getRange("D" + (ПоследняяСтрока + 1) + ":K" + (ПоследняяСтрока + 1)); // начальные координаты группы ячеек
  var КоличествоСтрок = 9; //  количество строк, на которое необходимо растянуть группу ячеек
  // ТаблицаЛист_2.insertRowsAfter(НачальныеКоординаты.getLastRow(), КоличествоСтрок);
  var КонечныеКоординаты = ТаблицаЛист_2.getRange(НачальныеКоординаты.getRow(), НачальныеКоординаты.getColumn(), НачальныеКоординаты.getNumRows() + КоличествоСтрок, НачальныеКоординаты.getNumColumns());
  НачальныеКоординаты.copyTo(КонечныеКоординаты);

  // обнуляем 9 строк с плечом:

  var ДиапазонПлечо9Ячеек = ТаблицаЛист_2.getRange("D" + (ПоследняяСтрока+1) + ":D" + (ПоследняяСтрока+9));
  ДиапазонПлечо9Ячеек.setValue("");

  // делаем окантовку границ ячеек:

  var Границы = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 1, 1, 3);
  Границы.setBorder(true, true, true, true, true, true, "white", SpreadsheetApp.BorderStyle.SOLID_THICK); // Устанавливаем границы для диапазона
  var ГраницыПлечи = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 4, 10, 8);
  ГраницыПлечи.setBorder(true, true, true, true, true, true, "white", SpreadsheetApp.BorderStyle.SOLID_THICK); // Устанавливаем границы для диапазона ячеек

  // объединяем ячейки для плана:

  var ПланЯчейки = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 8, 10, 1);
  ПланЯчейки.merge();

  // добавлем формулу в план:

  var ПланЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 8);
  var str = (ПоследняяСтрока + 1);
  var ПланФормула = '=IFERROR(IF(((IFERROR(E' + str + '/VLOOKUP(D' + str + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 1) + '/VLOOKUP(D' + (str + 1) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 2) + '/VLOOKUP(D' + (str + 2) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 3) + '/VLOOKUP(D' + (str + 3) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 4) + '/VLOOKUP(D' + (str + 4) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 5) + '/VLOOKUP(D' + (str + 5) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 6) + '/VLOOKUP(D' + (str + 6) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 7) + '/VLOOKUP(D' + (str + 7) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 8) + '/VLOOKUP(D' + (str + 8) + ";'Плечи(Лист1)'!A:J;10;FALSE);0) + IFERROR(E" + (str + 9) + '/VLOOKUP(D' + (str + 9) + ";'Плечи(Лист1)'!A:J;10;FALSE);0)))" + '>=1;"да";"нет");"")';
  ПланЯчейка.setFormula(ПланФормула);

  // добавляем в конце сумму расходов и доходов:

  var ПоследняяСтрока_2 = ТаблицаЛист_2.getLastRow();
  var ПрибыльИтогоЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 1), 6)
  var РасходИтогоЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 1), 7)

  // находим строку до которой нужно складывать столбцы:

  var столбец = 14; // по столбцу N
  var последняяСтрока_3 = ТаблицаЛист_2.getLastRow();
  var диапазон = ТаблицаЛист_2.getRange(1, столбец, последняяСтрока_3, 1);
  var значения = диапазон.getValues();
  for (var i = последняяСтрока_3 - 1; i >= 0; i--) 
  {
    if (значения[i][0] != "") {
      var последняяЯчейка = диапазон.getCell(i + 1, 1);
      var ПоследняяСтрокаFиG = i + 2;
      break;
    }
  }
  
  // выводим надпись Итого:

  var ПоследняяСтрока_2 = ТаблицаЛист_2.getLastRow();
  var ПрибыльЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 1), 5)
  ПрибыльЯчейка.setValue("Итого");

  // находим прибыль (разность дохода и расхода):

  var ПрибыльИтогоФормула = "=SUM(F" + ПоследняяСтрокаFиG + ":F" + ПоследняяСтрока_2 + ")";
  ПрибыльИтогоЯчейка.setFormula(ПрибыльИтогоФормула);
  var РасходИтогоФормула = "=SUM(G" + ПоследняяСтрокаFиG + ":G" + ПоследняяСтрока_2 + ")";
  РасходИтогоЯчейка.setFormula(РасходИтогоФормула);

  // закрашиваем строку с прибылью в темно-серый цвет:

  var Темно_Серый = '#686868'; // Код цвета для темно-серого
  var ВсяСтрока = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 1), 1, 1, 11);
  ВсяСтрока.setBackground(Темно_Серый);

  // делаем окантовку границ ячеек и сразу красим шрифт в белый и выделяем его жирным:

  // var ПоследняяСтрока_3 = ТаблицаЛист_2.getLastRow();
  // var ПоследнийСтолбец = ТаблицаЛист_2.getLastColumn();
  ВсяСтрока.setBorder(true, true, true, true, false, false, "white", SpreadsheetApp.BorderStyle.SOLID_THICK);
  var Границы = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 1), 5, 1, 7);
  Границы.setBorder(true, true, true, true, true, true, "white", SpreadsheetApp.BorderStyle.SOLID_THICK); // Устанавливаем границы для диапазона ячеек
  Границы.setFontWeight("bold");
  Границы.setFontColor(Белый)

    // находим прибыль (разность дохода и расхода):

  var ВыручкаИтогоЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 2), 6)
  var ВыручкаИтогоФормула = "=(F" + (ПоследняяСтрока_2 + 1) + "-G" + (ПоследняяСтрока_2 + 1) + ")";
  ВыручкаИтогоЯчейка.setFormula(ВыручкаИтогоФормула);

  // закрашиваем строку с прибылью в темно-серый цвет:

  var Темно_Серый = '#686868'; // Код цвета для темно-серого
  var ВсяСтрока = ТаблицаЛист_2.getRange((ПоследняяСтрока_2 + 2), 1, 1, 11);
  ВсяСтрока.setBackground(Темно_Серый);

  // выводим надпись Прибыль:

  var ПоследняяСтрока_2 = ТаблицаЛист_2.getLastRow();
  var ПрибыльЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока_2), 5)
  ПрибыльЯчейка.setValue("Прибыль");

  // делаем окантовку границ ячеек и сразу красим шрифт в белый и выделяем его жирным:

  // var ПоследняяСтрока_3 = ТаблицаЛист_2.getLastRow();
  // var ПоследнийСтолбец = ТаблицаЛист_2.getLastColumn();
  var ВсяСтрока = ТаблицаЛист_2.getRange((ПоследняяСтрока_2), 1, 1, 11);
  ВсяСтрока.setBorder(true, true, true, true, false, false, "white", SpreadsheetApp.BorderStyle.SOLID_THICK);
  var Границы = ТаблицаЛист_2.getRange((ПоследняяСтрока_2), 5, 1, 2);
  Границы.setBorder(true, true, true, true, true, true, "white", SpreadsheetApp.BorderStyle.SOLID_THICK); // Устанавливаем границы для диапазона ячеек
  Границы.setFontWeight("bold");
  Границы.setFontColor(Белый)

  // делаем ячейку для даты с подчеркиванием в столбце L:

  var Дата_Ячейки = ТаблицаЛист_2.getRange((ПоследняяСтрока + 1), 12, 10, 1);
  var Дата_Формула = '=IFERROR(IF($B' + (ПоследняяСтрока + 1) + '="";"";MONTH($B' + (ПоследняяСтрока + 1) + ')&"_"&YEAR($B' + (ПоследняяСтрока + 1) + '));"")';
  Дата_Ячейки.setFormula(Дата_Формула);
  Дата_Ячейки.setFontColor(Белый)

  // добавляем сумму З/П в конце:

  var ЗПСуммаЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 11), 9);
  var ЗПСуммаФормула = "=SUM(I" + (ПоследняяСтрока + 1) + ":I" + (ПоследняяСтрока + 10) + ")";
  ЗПСуммаЯчейка.setFormula(ЗПСуммаФормула);

  // добавляем сумму З/П + Процент в конце:

  var ЗП_ПроцентЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 11), 10);
  var ЗП_ПроцентФормула = "=SUM(J" + (ПоследняяСтрока + 1) + ":J" + (ПоследняяСтрока + 10) + ")";
  ЗП_ПроцентЯчейка.setFormula(ЗП_ПроцентФормула);

  // добавляем сумму Суточных в конце:

  var ЗП_ПроцентЯчейка = ТаблицаЛист_2.getRange((ПоследняяСтрока + 11), 11);
  var ЗП_ПроцентФормула = "=SUM(K" + (ПоследняяСтрока + 1) + ":K" + (ПоследняяСтрока + 10) + ")";
  ЗП_ПроцентЯчейка.setFormula(ЗП_ПроцентФормула);
}
